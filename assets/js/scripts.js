"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,_toPropertyKey(c.key),c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"===_typeof(b)?b:b+""}function _toPrimitive(a,b){if("object"!==_typeof(a)||null===a)return a;var c=a[Symbol.toPrimitive];if(c!==void 0){var d=c.call(a,b||"default");if("object"!==_typeof(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}$(document).one("rex:ready",function(){new QuickEdit});var QuickEdit=function(){function a(){var b=this;_classCallCheck(this,a),this.ADD_CLASS=1,this.REMOVE_CLASS=2,this.activeId=null,this.activeRowSelector=null,this.qeId=null,this.$activeQuickEdit=null,this.$activeForm=null,this.$rexAjaxLoader=$("#rex-js-ajax-loader"),this.$fixedNavbar=$(".rex-nav-top-is-fixed"),this.attachEventHandler(),$(document).on("keyup",function(a){"Escape"===a.key&&b.closeQuickEdit()})}return _createClass(a,[{key:"attachEventHandler",value:function attachEventHandler(){var a=this,b=$("a.yform-quick-edit");b.off("click"),b.on("click",function(b){b.preventDefault();var c=$(b.currentTarget),d=c.data("id"),e=c.parents("tr"),f=e.find("td").length;return a.showLoading(),a.activeId===d?(a.closeQuickEdit(),void a.hideLoading()):void(a.activeId!==d&&(a.closeQuickEdit(),a.activeId=d,a.qeId="yform-quick-edit-"+(200*Math.random()).toString(36).replace(".",""),a.activeRowSelector="tr.quick-edit-row-"+a.activeId,a.changeActiveRowClass("active",a.ADD_CLASS),e.after("<tr><td style=\"padding: 0;\" colspan=\""+f+"\"><div class=\"yqu-wrapper\" id=\""+a.qeId+"\"></div></td></tr>"),a.showQuickEdit(c.attr("href"),e)))})}},{key:"showQuickEdit",value:function showQuickEdit(a,b){var c=this;this.showLoading(),$.pjax({url:a,container:"#"+this.qeId,fragment:"#rex-yform",push:!1}),this.$activeQuickEdit=$("#"+this.qeId),this.$activeQuickEdit.on("pjax:end",function(){c.$activeForm=c.$activeQuickEdit.find("form.rex-yform"),c.attachSubmitHandler();var a=b.offset().top;c.$fixedNavbar.length&&(a-=c.$fixedNavbar.height()),$(window).scrollTop(a)}),this.$activeQuickEdit.on("pjax:beforeReplace",function(a,b){var d=$(b);d.find(".yqe-ignore").each(function(a,b){var c=$(b),d=c.closest(".form-group, .form-check-group");d.length?d.remove():c.remove()}),d.find(".btn-toolbar").append("<a href=\"#\" class=\"btn btn-danger\" id=\"yqe-cancel\">"+rex.yform_quick_edit_cancel+"</a>");var e=d.find("#yqe-cancel");e.on("click",function(a){a.preventDefault(),c.closeQuickEdit()})})}},{key:"attachSubmitHandler",value:function attachSubmitHandler(){var a=this;this.$activeForm.on("submit",function(b){if(b.preventDefault(),"undefined"!=typeof ckeditors)for(var c in ckeditors)ckeditors[c].updateSourceElement();$.ajax({type:"post",url:a.$activeForm.attr("action"),data:a.$activeForm.serialize(),success:function success(b){var c=$(b),d=c.find("form.rex-yform .form-group.has-error"),e=a.$activeForm.find(".alert-danger"),f=c.find("form.rex-yform .alert-danger");d.length?($(".has-error").removeClass("has-error"),a.addError(),d.each(function(b,c){var d=$(c);a.$activeForm.find("#"+d.attr("id")).addClass("has-error")}),e.length?e.replaceWith(f):a.$activeForm.prepend(f)):a.success=!0},error:function error(a){console.error("YForm QuickEdit","  \u21B4","\n",a)},complete:function complete(){a.hideLoading(),a.success&&a.closeQuickEdit(!0)}})})}},{key:"closeQuickEdit",value:function closeQuickEdit(a){var b=this;this.$activeQuickEdit&&(this.removeQuickEdit(),this.changeActiveRowClass("active",this.REMOVE_CLASS),this.changeActiveRowClass("error",this.REMOVE_CLASS),a?$.get(window.location.href,function(a){for(var c=$(a).find(b.activeRowSelector+" > *"),d=$(b.activeRowSelector+" > *"),e=0;e<c.length;e++){var f=d.eq(e),g=$(f.html());try{if("a"===g.prop("nodeName").toLowerCase()||f.hasClass("rex-table-action"))continue}catch(a){}f.html(c.eq(e).html())}b.resetQuickEdit()}):this.resetQuickEdit())}},{key:"removeQuickEdit",value:function removeQuickEdit(){this.$activeQuickEdit&&this.$activeQuickEdit.parents("tr").remove()}},{key:"resetQuickEdit",value:function resetQuickEdit(){this.activeId=null,this.activeRowSelector=null,this.$activeForm=null,this.$activeQuickEdit=null}},{key:"addError",value:function addError(){this.changeActiveRowClass("error",this.ADD_CLASS)}},{key:"changeActiveRowClass",value:function changeActiveRowClass(a,b){b===this.ADD_CLASS?$(this.activeRowSelector).addClass(a):b===this.REMOVE_CLASS&&$(this.activeRowSelector).removeClass(a)}},{key:"showLoading",value:function showLoading(){this.$rexAjaxLoader.addClass("rex-visible")}},{key:"hideLoading",value:function hideLoading(){this.$rexAjaxLoader.removeClass("rex-visible")}}]),a}();